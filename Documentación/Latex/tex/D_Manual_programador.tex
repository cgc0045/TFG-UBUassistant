\apendice{Documentación técnica de programación}

\section{Introducción}

En este apartado se va a explicar la estructura de directorios del proyecto que se ha desarrollado. También se incluyen los pasos necesarios para poder compilar, instalar y ejecutar el proyecto de una forma adecuada. A parte de todo esto, se incluye un manual de programador, para configurar correctamente los diferentes entornos que se han utilizado durante el proyecto.

\section{Estructura de directorios}

Los directorios que posee nuestro proyecto es el siguiente:

\begin{itemize}
	\tightlist
	\item
	\textbf{/:} el directorio raíz del proyecto posee el fichero \textit{README.md}, el cual contiene la licencia del proyecto. A parte de esto, tiene dentro todas las demás carpetas del proyecto, las cuales se detallan a continuación.
	\item 
	\textbf{/Código Fuente:} este directorio posee los diferentes ficheros fuente del proyecto, tanto de la aplicación Android como del servidor web. En este directorio también podemos encontrar el fichero SQL necesario para poder crear correctamente la base de datos con todos los casos base de nuestro algoritmo.
	\item 
	\textbf{/Código Fuente/Android/UBUassistant:} el contenido de este directorio es los ficheros necesarios para poder compilar la aplicación sin necesidad de utilizar \textit{Android Studio} para ello. Además incluye los directorios que poseen los ficheros fuente de la aplicación.
	\item 
	\textbf{/Código Fuente/Android/UBUassistant/app/build:} en este directorio se almacenan las diferentes clases compiladas de la aplicación en diferentes directorios.
	\item 
	\textbf{/Código Fuente/Android/UBUassistant/app/build/outputs/apk/debug:} en este directorio podemos encontrar el fichero APK de nuestra aplicación Android.
	\item 
	\textbf{/Código Fuente/Android/UBUassistant/app/src/main:} el contenido de este directorio es el código fuente de la aplicación Android junto a los recursos utilizados.
	\item 
	\textbf{/Código Fuente/Android/UBUassistant/app/src/main/java:} código fuente de la aplicación Android.
	\item 
	\textbf{/Código Fuente/Android/UBUassistant/app/src/main/res:} recursos utilizados en la aplicación Android.
	\item 
	\textbf{/Código Fuente/Tomcat App:} en este directorio encontramos los ficheros de nuestro servidor web. En este directorio nos encontramos con las carpetas \textit{UBUassistant} y \textit{UBUassistant\_admin}, estas dos carpetas poseen la misma estructura de directorios, con la diferencia que en \textit{UBUassistant} los ficheros JSP están programados para poder comunicarse con la aplicación Android, mientras que en \textit{UBUassistant\_admin}, los ficheros JSP están programados para mostrar la página de administración del algoritmo. Como referencia a estas dos carpetas, vamos a usar siempre la nomenclatura de \textit{UBUassistant}.
	\item 
	\textbf{/Código Fuente/Tomcat App/doc/javadoc:} en este directorio encontramos la documentación del código de nuestro proyecto generada con JavaDoc.
	\item 
	\textbf{/Código Fuente/Tomcat App/lib:} en este directorio nos encontramos con las diferentes librerías en formato JAR que son necesarias para el correcto funcionamiento de nuestro servidor.
	\item 
	\textbf{/Código Fuente/Tomcat App/rsc:} el contenido de este directorio son los diferentes recursos necesarios para nuestro servidor, como pueden ser los ficheros para realizar correctamente la conexión con la base de datos.
	\item 
	\textbf{/Código Fuente/Tomcat App/src:} en este directorio nos encontramos con el código fuente de nuestro servidor.
	\item 
	\textbf{/Código Fuente/Tomcat App/src/main:} clases del servidor, ficheros de configuración y archivos JSP/HTML.
	\item 
	\textbf{/Código Fuente/Tomcat App/src/main/java:} en este directorio encontramos los diferentes ficheros Java de nuestro servidor.
	\item 
	\textbf{/Código Fuente/Tomcat App/src/main/resources:} los diferentes ficheros de configuración de nuestro servidor.
	\item 
	\textbf{/Código Fuente/Tomcat App/src/main/webapp:} ficheros JSP/HTML para que funcione nuestro servidor. Como hemos mencionado antes, dependiendo del directorio en el que nos encontremos, los ficheros JSP sirven para la conexión de nuestro servidor con el cliente en Android o para ejecutar la aplicación web de administración.
	\item 
	\textbf{/Código Fuente/Tomcat App/target:} clases y librerías Maven compiladas del servidor web.
	\item 
	\textbf{/Documentación:} en este directorio nos podemos encontrar con la documentación del proyecto realizada con \textit{LaTeX}.
	\item 
	\textbf{/Documentación/img:} diferentes imágenes utilizadas en la documentación del proyecto.
	\item 
	\textbf{/Documentación/tex:} ficheros utilizados para la generación de la documentación.
	\item 
	\textbf{/Ejecutables:} en este directorio nos encontramos con los ficheros WAR para poder utilizarlos directamente en el servidor, como la aplicación APK para poder instalarla directamente en nuestro dispositivo Android.
\end{itemize}

\section{Manual del programador}

Las herramientas que se han utilizado para el desarrollo del proyecto y que son necesarias tener instaladas en el sistema son:

\begin{itemize}
	\tightlist
	\item
	\textbf{Java JDK 8}
	\item
	\textbf{Eclipse JEE}
	\item
	\textbf{Android Studio}
	\item
	\textbf{Tomcat}
	\item
	\textbf{MySQL}
\end{itemize}

No todas las herramientas que se han instalado tienen que ir instaladas en el mismo ordenador, sino que unas se instalan en el ordenador que se ha utilizado para programar el sistemas, mientras que otras se instalan en la máquina remota de Microsoft Azure que se utiliza como servidor de la aplicación.

Debido a que se ha utilizado como sistema operativo Linux, se va a explicar como instalar las siguientes herramientas en este sistema operativo.

\subsection{Herramientas de programación}

\subsubsection{Java JDK 8} \label{{jdk}}

Java JDK (\textit{Java Development Kit}) es un conjunto de herramientas necesarias para el desarrollo de aplicaciones Java. Para instalarlo en un sistema Linux, hay que abrir una sesión en el terminal e introducir los siguientes comandos \cite{jdk:install}:

\begin{center}
	\textit{\textbf{sudo add-apt-repository ppa:webupd8team/java}} \\
	\textbf{\textit{sudo apt update}} \\
	\textit{\textbf{sudo apt install oracle-java8-set-default}}
\end{center}

Con estos comandos, el paquete se instala y configura automáticamente, incluyendo las diferentes variables de entorno.

\subsubsection{Eclipse JEE}

Eclipse JEE es una versión de Eclipse que con todas las herramientas que son necesarias para el desarrollo de aplicaciones web basadas en Java.

Para la instalación, primero tenemos que descargarnos la aplicación desde la página web oficial \cite{eclipse:install}. Una vez que tengamos el fichero descargado, lo descomprimimos en la carpeta que deseemos. Desde esa carpeta, ya se puede iniciar la aplicación directamente si abrimos el fichero \textit{eclipse}. En caso de que queramos crear un acceso en nuestra barra de inicio, introducimos el siguiente comando desde una ventana del terminal:

\begin{center}
	\textbf{\textit{nano ~/.local/share/applications/opt\_eclipse.desktop}}
\end{center}

En el editor que se nos ha abierto, introducimos lo siguiente y guardamos el fichero.

\imagen{EclipseDesktop.png}{Configuración .dektop Eclipse}

Finalmente, para que se pueda ejecutar el programa desde el acceso directo correctamente, introducimos el siguiente comando:

\begin{center}
	\textbf{\textit{chmod +x ~/.local/share/applications/opt\_eclipse.desktop}}
\end{center}

\subsubsection{Android Studio}

Android Studio es el IDE oficial que nos ofrece Google para el desarrollo de aplicaciones para Android. Para descargar la última versión, lo podemos hacer desde su página web oficial \cite{androidstudio:install}. Una vez que tenemos descargado el fichero, lo podemos descomprimir en la localización que nosotros deseemos, al igual que en Eclipse. Una vez que lo tenemos descomprimido, lo podemos ejecutar a través del fichero \textit{CARPETA\_ANDROID\_STUDIO/bin/studio.sh}.

Si queremos crear un acceso a nuestra barra de inicio, introducimos el siguiente comando en una terminal:

\begin{center}
	\textbf{\textit{nano ~/.local/share/applications/androidstudio.desktop}}
\end{center}

Dentro del editor, introducimos el siguiente texto y lo guardamos:

\begin{flushleft}
	\textbf{\textit{
	[Desktop Entry] \\
	Version=1.0 \\
	Type=Application \\
	Name=Android Studio \\
	Exec=CARPETA\_ANDROID\_STUDIO/bin/studio.sh \%f \\
	Icon=CARPETA\_ANDROID\_STUDIO/bin/studio.png \\
	Categories=Development;IDE; \\
	Terminal=false \\
	StartupNotify=true \\
	StartupWMClass=android-studio \\
	}}
\end{flushleft}

Finalmente, para que se puede ejecutar desde la aplicación, introducimos el siguiente comando desde una terminal:

\begin{center}
	\textbf{\textit{chmod +x ~/.local/share/applications/androidstudio.desktop}}
\end{center}

\imagen{AndroidStudioInterfaz.png}{Interfaz Android Studio}

\subsection{Herramientas del servidor}

\subsubsection{Java JDK 8}

En el servidor, también es necesario que tengamos instalado Java JDK 8, por lo que seguimos los mismos pasos que se han mencionado con anterioridad en la sección \ref{{jdk}}.

\subsubsection{Tomcat}
Tomcat es una plataforma que nos permite ejecutar aplicaciones web basadas en Java que se encuentren en formato WAR. Para la instalación, primero descargamos la última versión de Tomcat 9 desde la página oficial de Tomcat \cite{tomcat:download}. Una vez que tengamos descargado el fichero, abrimos una terminal e introducimos los siguientes comandos \cite{tomcat:install}, recomendando la ejecución del terminal con permisos de administrador:

\begin{center}
	\textbf{\textit{
	groupadd tomcat \\
	useradd -s /bin/false -g tomcat -d /opt/tomcat tomcat \\
	cd /CARPETA\_FICHEROS\_TOMCAT \\
	cp ./FICHERO\_TOMCAT.tar.gz /opt \\
	tar -xzvf ./FICHERO\_TOMCAT.tar.gz \\
	mv apache-tomcat-9.X.X/ tomcat/ \\
	chown -R tomcat:tomcat /opt/tomcat \\
	chmod +x /opt/tomcat/bin/* \\
	nano ~/.bashrc \\
	}}
\end{center}

En el fichero que se ha abierto para editar, introducimos la siguiente línea al final del fichero y lo guardamos:

\begin{flushleft}
	\textbf{\textit{export CATALINA\_HOME=/opt/tomcat}}
\end{flushleft}

Sin cerrar la terminal, seguimos introduciendo los siguientes comandos:

\begin{center}
	\textbf{\textit{
	source ~/.bashrc \\
	\$CATALINA\_HOME/bin/startup.sh
	}}
\end{center}

Con esto, tendríamos Tomcat totalmente configurado  y funcionando. Para ver que funciona correctamente, podemos acceder introduciendo el ip del servidor en un navegador (\textit{http://192.168.x.x:8080/}) y nos debería de aparecer lo siguiente:

\imagen{Tomcat.png}{Ventana inicio Tomcat}

Finalmente, hay que configurar el inicio de Tomcat como servicio, para que este se inicie automáticamente cada vez que se inicia el servidor. Para ello, abrimos una ventana del terminal e introducimos los siguientes comandos:

\begin{center}
	\textbf{\textit{
	\$CATALINA\_HOME/bin/shutdown.sh \\
	chown -hR tomcat:tomcat /opt/tomcat/ \\
	cd /etc/systemd/system/ \\
	nano apache-tomcat.service
	}}
\end{center}

En el fichero que se nos abre para modificar, introducimos las siguientes líneas y guardamos el fichero:

\imagen{TomcatService.png}{Configuración fichero de servicio de Tomcat}

Sin cerrar la terminal, introducimos los siguientes comandos:

\begin{center}
	\textbf{\textit{
	systemctl daemon-reload \\
	systemctl start apache-tomcat \\
	systemctl enable apache-tomcat \\
	}}
\end{center}

Con todo esto, ya estaría correctamente configurado nuestro servidor de Tomcat y en caso de que tengamos que reiniciar nuestro servidor, nos garantizamos que el servicio se inicia automáticamente.

\subsubsection{MySQL}

MySQL es un sistema de gestión de base de datos. Para la instalación, tenemos que abrir una ventana del terminal e introducir los siguientes comandos \cite{mysql:install}:

\begin{center}
	\textbf{\textit{
			sudo apt install mysql-server \\
			sudo mysql\_secure\_installation \\
	}}
\end{center}

Estas acciones, mostrarán una serie de mensajes para configurar el usuario \textit{root} de la base de datos. En la primera opción que nos aparece, le indicamos que no queremos usar \textit{Validate Password Plugin}. Lo siguiente que haremos es introducir la contraseña del usuario \textit{root}, la cuál para este proyecto el valor que se la ha establecido es \textit{1234}. El resto de opciones que nos va dando, las aceptamos todas para que finalice la configuración de MySQL. Finalmente, para que todo quede correctamente inicializado, introducimos el siguiente comando en una terminal:
\begin{center}
	\textbf{\textit{mysqld --initialize}}
\end{center}

Con estos pasos, ya estaría todo configurado correctamente. Para administrar las bases de datos MySQL, solamente tenemos que introducir el siguiente comando en una ventana del terminal:

\begin{center}
	\textbf{\textit{mysql -u root -p}}
\end{center}

\imagen{MySQLTerminal.png}{Ventana de administración de MySQL}

\newpage

\section{Compilación, instalación y ejecución del proyecto}

\subsection{Obtención del código}

Lo primero que tenemos que hacer, es obtener el código de la aplicación. Para ello, se puede descargar desde el respositorio GitHub del proyecto \cite{github:ubuassistant}.

Una vez que nos encontramos dentro de la página del repositorio, lo podemos descargar pulsando primero sobre el botón \textit{Clone or download} y posteriormente sobre \textit{Download ZIP}. Una vez que se termine de descargar el fichero, lo extraemos en la ruta que el usuario prefiera.

\imagen{DescargaProyecto.png}{Descarga del proyecto desde GitHub}

Una vez que hemos realizado esto, lo que tenemos que hacer es importar las diferentes partes del proyecto en sus respectivos IDE's.

\subsection{Importar proyecto en Android}

Lo primero que tenemos que hacer es abrir la aplicación de Android Studio. Una vez que la tenemos abierta, nos dirigimos al menú \textit{File} y pulsamos sobre la opción \textit{Open}. Se nos abrirá una nueva ventana, en la cuál podemos navegar hasta el directorio de nuestra aplicación. Android Studio nos facilita encontrar los proyectos que han sido creados con la misma herramienta, ya que cuando identifica uno, cambia el icono de carpeta por el icono de Android Studio. Una vez que tenemos seleccionada la carpeta, pulsamos sobre el botón \textit{OK}.

\imagenMuyPeque{IconoAS.png}{Icono Android Studio}

Si todo ha sido importado correctamente, en el menú de la izquierda nos debería de aparecer los diferentes componentes que conforman la aplicación.

\imagen{ImportAS.png}{Proyecto importado en Android Studio}

Para exportar la aplicación a un fichero APK, en la barra de opciones superior abrimos el menú \textit{Build} y seleccionamos la opción \textit{Build APK(s)}. Esta opción nos genera un fichero APK en la ruta:
\begin{center}
	\textit{\textbf{CARPETA\_APLICACIÓN\_ANDROID/app/build/outputs/apk/debug}}
\end{center}

\subsection{Importar proyecto en Eclipse JEE}

Lo primero que hacemos es iniciar Elcipse JEE y seleccionamos la carpeta donde queremos alojar nuestro \textit{Workspace}. Una vez que se termina de abrir el programa, sobre el menú de la izquierda abrimos un menú pulsando sobre el botón derecho de nuestro ratón y en el desplegable de la opción \textit{Import} seleccionamos \textit{Import...}. En la ventana que se abre, nos dirigimos a la opción llamada \textit{Maven}, seleccionamos la opción \textit{Existing Maven Projects} y pulsamos sobre el botón \textit{Next}.

\imagenMediana{ImportMaven.png}{Selección del tipo de proyecto}

En la siguiente ventana que nos aparece, hacemos seleccionamos la opción \textit{Browse...}, navegamos hasta el directorio donde se aloja la parte del código del servidor web y seleccionamos la opción \textit{OK}. De nuevo a la ventana que teníamos con anterioridad, seleccionamos el proyecto y para terminar la importación, seleccionamos la opción \textit{Finish}.

\imagenMediana{ImportProjectEclipse.png}{Selección del proyecto}


Si todo se ha realizado de forma correcta, en el menú de la izquierda nos tiene que aparecer el proyecto y si lo desplegamos, nos aparecerán los diferentes directorios y ficheros del proyecto.

\imagenPeque{ProyectoImportadoEclipse.png}{Proyecto importado en Eclipse JEE}

Ahora, hay que configurar el \textit{PATH} del proyecto, para que se importen correctamente las diferentes librerías que se usan en la aplicación. Para ello, seleccionamos el proyecto y con el botón derecho del ratón desplegamos el menú de opciones. Con el ratón, nos dirigimos a la opción \textit{Build Path} y en el desplegable seleccionamos \textit{Configure Build Path}. En la ventana que ha aparecido, seleccionamos la opción \textit{Add JARs...}. A continuación, se abre una ventana, la cuál permite desplazarse por los directorios del proyecto, abrimos la carpeta \textit{lib} y seleccionamos todos los ficheros JAR que hay en su interior. Para finalizar la configuración, seleccionamos la opción \textit{Apply and Close}.

\imagen{PathEclipse.png}{Configuración del PATH en Eclipse JEE}

Finalmente, hay que configurar el proyecto para que cuando exportemos la aplicación al fichero WAR para usarlo en nuestro servidor Tomcat, incluya todas las librerías que se utilizan en el proyecto.

Para ello, seleccionamos nuestro proyecto y en el menú de opciones que abrimos pulsando el botón derecho del ratón, seleccionamos la opción \textit{Properties}. En la ventana que nos aparece, seleccionamos en el menú de la izquierda la opción \textit{Deployment Assembly}. En la parte derecha de la ventana nos aparecerá un listado con carpetas y ficheros. Para añadir nuestras librerías a esta lista, pulsamos sobre \textit{Add...}. En la ventana que nos ha aparecido, seleccionamos \textit{Java Build Path Entries} y seleccionamos todas las librería que nos aparecen. Para finalizar la configuración, pulsamos sobre \textit{Apply and Close}.

\imagen{ConfWAREclipse.png}{Configuración de librerías en el fichero WAR}

Con todo esto, tendríamos el proyecto configurado correctamente para poder modificarlo y exportarlo correctamente.

Para exportar el proyecto a un fichero WAR, seleccionamos el proyecto, abrimos el menú de opciones con el botón derecho de nuestro ratón y sobre el desplegable \textit{Export} seleccionamos la opción \textit{WAR file}. En la ventana que se abre, seleccionamos el directorio donde queremos guardar el fichero junto a su nombre y pulsamos sobre \textit{Finish}.

\imagenMediana{ExportWAR.png}{Exportar servidor a fichero WAR}


\section{Pruebas del sistema}

Para comprobar las funcionalidades del proyecto se han realizado una serie de tests y pruebas. Las pruebas realizadas en el servidor son diferentes a las realizadas en la aplicación Android.

\subsection{Pruebas aplicación Android}

Para la aplicación Android, se han realizado una serie de pruebas de forma manual para comprobar las diferentes funcionalidades que lleva implementada. Las diferentes pruebas que se han realizado, junto al resultado esperado, así como el objetivo del mismo se pueden observar en la siguiente tabla.

\tablaSinColores{Pruebas manuales}
{p{4cm} p{4cm} p{6cm}}{3}{pruebasmanuales}
{\textbf{Entrada} & \textbf{Respuesta} & \textbf{Finalidad}\\}{
	esternocleidomastoideo (introducido por voz)	& esternocleidomastoideo	& Comprobar la funcionalidad de reconocimiento de voz. \\
	\midrule
	informática máster online						& informatica(master, online) & Comprobar la funcionalidad de obtención de única respuesta. \\
	\midrule
	informática										& informatica(master)		& Comprobar la funcionalidad de \\
													& informatica(online)		& obtener múltiples respuestas. \\
													& informatica (master, online) & \\
													& informatica				& \\
	\midrule
	google											& lengua (online)			& Comprobar la funcionalidad de \\
													& abogacia					& búsqueda sin resultados y \\
													& mecanica y electronica	& ofrece recomendaciones. \\
	\midrule
	buenos días										& Buenos días, ponme a prueba con tus preguntas. & Comprobar la funcionalidad de uso de palabras reservadas, como las de saludo. \\
}

Para saber la respuesta que nos tenía que dar estas pruebas (exceptuando la prueba de comando de voz), se realizaron primero diferentes pruebas con la aplicación web original desarrollada en el anterior TFG. Por cada prueba se realizaron diferentes iteraciones por cada prueba, asegurándose así que siempre se obtiene el mismo resultado.

\subsection{Pruebas servidor Tomcat}

Para probar los cambios en el servidor web Tomcat, se han aprovechado algunos de los test JUnit que se realizó Daniel Santidrián Alonso en la versión previa del TFG, mientras que otras pruebas se han realizado de forma manual.

\subsubsection{Test JUnit 4}

Se han aprovechado los tests existentes de JUnit para comprobar que la funcionalidad de la base de datos ampliada a siete vocablos funciona correctamente. Para ello, se han hecho unos pequeños cambios en el test para que este se ajuste a este requisito del proyecto. Esta prueba consta en un total de 12 test unitarios alojados en 3 clases.

\imagen{TestDatabase.png}{Test unitarios de la base de datos}

Para la ejecución de cada una de las clases, solamente es necesario abrirlas y ejecutarlas.

\imagen{EjecucionTest.png}{Ejecución de una clase con test unitarios}

\subsubsection{Test manuales}

Para comprobar que los cambios en la interfaz de la web de administración se realizaron de forma manual, ya que los test que se encontraban preparados en la versión anterior del TFG solamente son válidos para Windows. Las pruebas que se realizaron fueron:

\tablaSinColores{Pruebas manuales web de administración}
{p{3cm} p{3cm} p{8cm}}{3}{pruebasmanuales2}
{\textbf{Entrada} & \textbf{Respuesta} & \textbf{Finalidad}\\}{
	Añadir nuevo caso	& Caso añadido a la base de datos	& Comprobar que la funcionalidad de adición de nuevos casos con siete vocablos funciona correctamente. \\
	\midrule
	Editar caso existente	& Caso modificado en la base de datos & Comprobar que la funcionalidad de modificación de casos con siete vocablos funciona correctamente. \\
	\midrule
	Eliminar caso existente & Caso eliminado de la base de datos & Comprobar que a pesar de haber ampliado a siete vocables, el borrado de casos sigue funcionando correctamente. \\
	\midrule
	\textit{Ninguna}		& Visualización del log	& Comprobar que el log se muestra correctamente a pesar de haber ampliado a siete vocablos. \\
	\midrule
	\textit{Ninguna}		& Fichero exportado		& Comprobar que el log se exporta correctamente con siete vocablos. \\
	\midrule
	Aceptar aprendizaje		& Recomendación añadida como caso	& Comprobar que las recomendaciones se añaden correctamente con siete vocablos al asistente virtual. \\
}